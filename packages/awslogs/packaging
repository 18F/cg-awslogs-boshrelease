set -eux

export PYTHONPATH=${BOSH_INSTALL_TARGET}/lib/python

# awslogs now depends on this specific version :( of pyyaml and wants to build the C version by default
# force the pure-python install instead
${BOSH_INSTALL_TARGET}/bin/pip3 install PyYAML==3.11 --global-option="--without-libyaml"

# install awscli and the cwlogs plugin
${BOSH_INSTALL_TARGET}/bin/pip3 install awscli-cwlogs

# configure aws logs
${BOSH_INSTALL_TARGET}/bin/aws configure set plugins.cwlogs cwlogs
${BOSH_INSTALL_TARGET}/bin/aws configure set default.region $(ec2metadata --availability-zone | sed 's/.$//')
