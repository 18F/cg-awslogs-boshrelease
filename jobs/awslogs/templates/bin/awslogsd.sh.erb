#!/bin/sh
# Version: 1.1.2-rpm

export AWS_ACCESS_KEY_ID="<%= p('awslogs.access_key') %>"
export AWS_SECRET_ACCESS_KEY="<%= p('awslogs.secret_access_key') %>"

mkdir -p /var/vcap/sys/log/awslogs
[ -f /var/vcap/jobs/awslogs/config/proxy.conf ] && . /var/vcap/jobs/awslogs/config/proxy.conf
exec /usr/bin/env -i \
  HTTPS_PROXY=$HTTPS_PROXY \
  HTTP_PROXY=$HTTP_PROXY \
  NO_PROXY=$NO_PROXY \
  AWS_CONFIG_FILE=/var/vcap/jobs/awslogs/config/awscli.conf \
  HOME=/root \
  /bin/nice -n 4 /var/vcap/packages/awslogs/bin/aws logs push \
  --config-file /var/vcap/jobs/awslogs/config/awslogs.conf \
  --additional-configs-dir /var/vcap/jobs/awslogs/config/config >> /var/vcap/sys/log/awslogs/awslogs.log 2>&1


